---
- name: Initialize Cluster API
  become: "{{ clusterapi_install_become }}"
  ansible.builtin.shell: |
    export KUBECONFIG={{ clusterapi_install_kubeconfig }}
    /usr/local/bin/clusterctl init --infrastructure {{ clusterapi_install_infrastructure }}
  register: result
  changed_when: "'Your management cluster has been initialized successfully' in result.stdout"
