#!/usr/bin/env bash

# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

PARAMETERS=${PARAMETERS:-}

if [[ -t 0 ]]; then
    INTERACTIVE=${INTERACTIVE:-true}
else
    INTERACTIVE=${INTERACTIVE:-false}
fi

if [[ -n "$KUBECONFIG" ]]; then
    PARAMETERS="$PARAMETERS --env KUBECONFIG=$KUBECONFIG"
else
    PARAMETERS="$PARAMETERS --env KUBECONFIG=kubeconfig"
fi

PREFIX="HELM_"
ENV_ARGS=()

while IFS='=' read -r name value; do
    if [[ $name == ${PREFIX}* ]]; then
        ENV_ARGS+=("-e" "${name}=${value}")
    fi
done < <(env)

if [[ "${DISABLE_CERT_VALIDATION:-false}" == "true" ]]; then
    exec docker exec $PARAMETERS "${ENV_ARGS[@]}" helm helm --kube-insecure-skip-tls-verify "$@"
else
    exec docker exec $PARAMETERS "${ENV_ARGS[@]}" helm helm "$@"
fi
